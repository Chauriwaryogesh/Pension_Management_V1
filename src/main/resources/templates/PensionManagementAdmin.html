<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Pension Management - Secure Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body, html {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            height: 100vh;
            overflow-x: hidden;
            color: #1f2937;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        .sidebar {
            --sidebar-width-collapsed: 80px;
            --sidebar-width-expanded: 280px;
            width: var(--sidebar-width-collapsed);
            background: #ffffff;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            z-index: 100;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e2e8f0;
            position: relative;
            height: 100vh;
            flex-shrink: 0;
        }
        .sidebar:hover,
        .sidebar.expanded {
            width: var(--sidebar-width-expanded);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12);
        }
        .sidebar-collapse-btn {
            position: absolute;
            top: 20px;
            right: -16px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, background-color 0.3s ease;
            z-index: 101;
        }
        .sidebar-collapse-btn:hover {
            background-color: #2563eb;
            transform: scale(1.05);
        }
        .sidebar.expanded .sidebar-collapse-btn {
            transform: rotate(180deg);
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 20px;
            color: #4b5563;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            transition: color 0.2s, background-color 0.2s, transform 0.2s ease;
            border-radius: 8px;
            margin: 4px 12px;
            text-decoration: none;
        }
        .sidebar-link:hover,
        .sidebar-link.active {
            color: #2563eb;
            background-color: #eff6ff;
            transform: translateX(4px);
        }
        .sidebar-link i {
            font-size: 1.15rem;
            min-width: 24px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .sidebar-link-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: opacity 0.3s ease-in-out 0.1s, width 0.3s ease-in-out 0.1s;
        }
        .sidebar:hover .sidebar-link-text,
        .sidebar.expanded .sidebar-link-text,
        .sidebar.active .sidebar-link-text {
            opacity: 1;
            width: auto;
        }
        .sidebar-header {
            padding: 0 20px;
            justify-content: flex-start;
            flex-shrink: 0;
        }
        .sidebar-header .logo-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: opacity 0.3s ease-in-out 0.1s, width 0.3s ease-in-out 0.1s;
        }
        .sidebar:hover .logo-text,
        .sidebar.expanded .logo-text,
        .sidebar.active .logo-text {
            display: block;
            opacity: 1;
            width: auto;
        }
        .sidebar-header .sidebar-icon-collapsed {
            display: block;
        }
        .sidebar:hover .sidebar-icon-collapsed,
        .sidebar.expanded .sidebar-icon-collapsed,
        .sidebar.active .sidebar-icon-collapsed {
            display: none;
        }

        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
                width: var(--sidebar-width-expanded);
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                z-index: 1000;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .sidebar-collapse-btn {
                display: none;
            }
        }

        header {
            background-color: #ffffff;
            padding: 0.75rem 1rem;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
            height: 4.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            z-index: 50;
        }
        header .flex.items-center.gap-4 { display: flex; align-items: center; gap: 1rem; margin-left: 1rem; min-width: 0; flex-shrink: 1; }
        #welcome-message { font-size: 0.875rem; font-weight: 500; color: #4b5563; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 24rem; flex-shrink: 1; }
        @media (min-width: 768px) { #welcome-message { display: block; max-width: 28rem; } }
        @media (min-width: 1024px) { #welcome-message { max-width: 32rem; } }

        .main-content-area {
            flex-grow: 1;
            padding-bottom: 40px;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-box {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.2);
            animation: fadeInScale 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: #ef4444;
            cursor: pointer;
            transition: color 0.2s ease;
            z-index: 1001;
        }
        .modal-close-btn:hover {
            color: #dc2626;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .info-card {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .policy-card {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        .policy-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);
            border-color: #3b82f6;
        }
        .policy-card h4 {
            font-weight: 700;
            color: #1f2937;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .policy-card p {
            font-size: 0.8rem;
            color: #4b5563;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .policy-card .status-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        .policy-card .status-ACTIVE { background-color: #d1fae5; color: #065f46; }
        .policy-card .status-PENDING { background-color: #fef3c7; color: #d97706; }
        .policy-card .status-IN_PROGRESS { background-color: #bfdbfe; color: #1e40af; }
        .policy-card .status-APPROVED { background-color: #d1fae5; color: #065f46; }
        .policy-card .status-REJECTED { background-color: #fee2e2; color: #991b1b; }
        .policy-card .status-LAPSED { background-color: #fbd38d; color: #c05621; } /* Orange for Lapsed */
        .policy-card .status-MATURED { background-color: #c3dafe; color: #3182ce; } /* Lighter blue for Matured */
        .policy-card .status-CLOSED { background-color: #e2e8f0; color: #4a5568; } /* Grey for Closed */


        .main-footer {
            width: 100%;
            padding: 0.25rem 0.5rem;
            background-color: #e0f2fe;
            color: #1e40af;
            text-align: center;
            font-size: 0.65rem;
            position: fixed;
            bottom: 0;
            border-top: 1px solid #93c5fd;
            z-index: 999;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
            border-radius: 1.25rem 1.25rem 0 0;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: none;
            font-size: 0.875rem;
            background-color: #3b82f6;
            color: #ffffff;
        }
        .action-button:hover:not(:disabled) {
            background-color: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .action-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .action-button.secondary {
            background-color: #6b7280;
        }
        .action-button.secondary:hover {
            background-color: #4b5563;
        }
        .action-button.red {
            background-color: #ef4444;
        }
        .action-button.red:hover {
            background-color: #dc2626;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #f9fafb;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        #notificationModal .modal-box {
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #notificationModal.active .modal-box {
            transform: scale(1);
            opacity: 1;
        }
        #notification-title.text-red-600 { color: #dc2626; }
        #notification-title.text-green-600 { color: #10b981; }
        #notification-title.text-blue-600 { color: #3b82f6; }
        #notification-close-btn.bg-red-500 { background-color: #dc2626; }
        #notification-close-btn.bg-blue-500 { background-color: #3b82f6; }

        /* Full-screen modal for policy details */
        #policyDetailAdminModal .modal-box {
            width: 95%;
            height: 95%;
            max-width: none;
            max-height: none;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        #policyDetailAdminModal .modal-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 1rem;
            text-align: left;
        }
        .policy-detail-section {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
        }
        .policy-detail-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 1rem;
            border-bottom: 2px solid #eff6ff;
            padding-bottom: 0.5rem;
        }

        .filter-section details {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        .filter-section summary {
            font-weight: 600;
            color: #3b82f6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .filter-section summary i {
            transition: transform 0.2s ease;
        }
        .filter-section details[open] summary i {
            transform: rotate(180deg);
        }

        .filter-criteria {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding-top: 1rem;
        }

        .tab-button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            flex-grow: 1;
        }
        .tab-button {
            padding: 0.6rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #e0e7ff;
            color: #4f46e5;
            border: 1px solid #c7d2fe;
        }
        .tab-button.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.2);
        }
        .tab-button:hover:not(.active) {
            background-color: #c7d2fe;
        }

        .request-card {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 1.2rem;
            border: 1px solid #e2e8f0;
            margin-bottom: 1rem;
        }
        .request-card h4 {
            font-weight: 600;
            color: #3b82f6;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        .request-card p {
            font-size: 0.85rem;
            color: #4b5563;
        }
        .request-card .actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        /* Delete Confirmation Modal */
        #deleteConfirmationModal .modal-box {
            max-width: 400px;
            text-align: center;
        }

        /* View Toggle Buttons */
        .view-toggle-button.active-view {
            background-color: #3b82f6;
            color: white;
        }
        
        /* Policy List Table View */
        .policy-list-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        .policy-list-table th, .policy-list-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.875rem;
        }
        .policy-list-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #4b5563;
        }
        .policy-list-table tbody tr:hover {
            background-color: #eff6ff;
        }
        .policy-list-table .actions-cell {
            text-align: right;
            white-space: nowrap;
        }

        /* Bank Details Card */
        .bank-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            font-size: 0.875rem;
        }
        .bank-card-item {
            display: flex;
            flex-direction: column;
        }
        .bank-card-item .label {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 0.1rem;
        }
        .bank-card-item .value {
            font-weight: 600;
            color: #1e293b;
        }
        .bank-card-item .status-badge {
             padding: 0.15rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            width: fit-content;
        }
        .bank-card-item .status-REJECTED { background-color: #fee2e2; color: #991b1b; }
        .bank-card-item .status-APPROVED, .bank-card-item .status-ACTIVE { background-color: #dcfce7; color: #166534; }


    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen">
        <aside id="sidebar" class="sidebar flex flex-col h-full flex-shrink-0" aria-label="Main navigation">
            <button id="sidebar-collapse-btn" class="sidebar-collapse-btn hidden lg:flex" aria-label="Toggle sidebar" aria-expanded="false">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <div class="sidebar-header flex items-center justify-center h-20 flex-shrink-0 border-b border-gray-200">
                <i id="sidebar-header-collapsed-icon" class="fa-solid fa-folder-open text-3xl text-blue-600 sidebar-icon-collapsed"></i>
                <h2 id="sidebar-header-logo-text" class="text-2xl font-bold ml-3 text-gray-800 logo-text">Secure Access</h2>
            </div>
            <nav class="flex-1 space-y-1 mt-4 custom-scrollbar overflow-y-auto" role="navigation">
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('dashboard')" aria-label="Go to Dashboard">
                    <i class="fa-solid fa-border-all"></i><span class="sidebar-link-text">Dashboard</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('policySurrenderAdmin')" aria-label="Go to Policy Surrender Admin">
                    <i class="fa-solid fa-hand-holding-usd"></i><span class="sidebar-link-text">Surrender Requests</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('policyClaimAdmin')" aria-label="Go to Policy Claim Admin">
                    <i class="fa-solid fa-file-invoice-dollar"></i><span class="sidebar-link-text">Claim Requests</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('bankAccount')" aria-label="Go to Bank Accounts">
                    <i class="fa-solid fa-bank"></i><span class="sidebar-link-text">Bank Accounts</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('payment')" aria-label="Go to Payments">
                    <i class="fa-solid fa-credit-card"></i><span class="sidebar-link-text">Payments</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('notes')" aria-label="Go to Admin Notes">
                    <i class="fa-solid fa-clipboard"></i><span class="sidebar-link-text">Admin Notes</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('complaints')" aria-label="Go to Complaints">
                    <i class="fa-solid fa-comments"></i><span class="sidebar-link-text">Complaints</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('documents')" aria-label="Go to Documents">
                    <i class="fa-solid fa-folder-open"></i><span class="sidebar-link-text">Documents</span>
                </a>
                <a href="#" class="sidebar-link w-full active" onclick="switchView('pension')" aria-label="Go to Pension Management">
                    <i class="fa-solid fa-umbrella-beach"></i><span class="sidebar-link-text">Pension Management</span>
                </a>
                <a href="#" class="sidebar-link w-full" onclick="navigateTo('policyHealthCheck')" aria-label="Go to Policy Health Check">
                    <i class="fa-solid fa-heartbeat"></i><span class="sidebar-link-text">Policy Health Check</span>
                </a>
                 <a href="#" class="sidebar-link w-full" onclick="switchView('processed')" aria-label="Go to Processed Requests">
                    <i class="fa-solid fa-check-double"></i><span class="sidebar-link-text">Processed Requests</span>
                </a>
                <div class="border-t border-gray-200 my-2"></div>
            </nav>
            <div class="p-4 border-t border-gray-200">
                <a href="#" class="sidebar-link w-full text-red-500 hover:bg-red-50 hover:text-red-600" onclick="logout()" aria-label="Logout">
                    <i class="fa-solid fa-right-from-bracket"></i><span class="sidebar-link-text">Logout</span>
                </a>
            </div>
        </aside>

        <div class="flex-1 flex flex-col h-screen">
            <header class="bg-white p-4 flex-shrink-0 flex justify-between items-center border-b h-20">
                <button id="sidebar-toggle" class="lg:hidden text-gray-600"><i class="fa-solid fa-bars text-xl"></i></button>
                <h1 class="text-3xl font-bold text-gray-800 ml-4">Admin Pension Management</h1>
                <div class="flex items-center gap-4 ml-auto">
                    <div id="profile-info" class="text-md font-medium text-gray-600 truncate hidden md:block">
                        <span id="display-user-code"></span><br>
                        <span id="display-customer-no"></span>
                    </div>
                    <button id="btn-profile" title="User Info" class="h-12 w-12 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors flex items-center justify-center flex-shrink-0">
                        <img id="profile-icon" src="https://placehold.co/40x40/E2E8F0/4A5568?text=U" alt="User" class="h-10 w-10 rounded-full object-cover">
                    </button>
                </div>
            </header>

            <main class="flex-1 p-6 lg:p-8 overflow-y-auto custom-scrollbar main-content-area">
                <div id="pension-management-view">
                    <!-- Policy Overview Counts -->
                    <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-4 mb-8" id="policy-count-cards">
                        <!-- Cards will be rendered here by JavaScript -->
                    </div>

                    <!-- Search and Filter Section -->
                    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                        <div class="flex flex-col md:flex-row gap-4 mb-4">
                            <div class="relative flex-grow">
                                <input type="text" id="policy-search-input" placeholder="Search by Policy No, Holder, or Customer No" class="input-field pl-10" aria-label="Search policies">
                                <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            </div>
                            <button id="apply-search-btn" class="action-button flex-shrink-0">Search</button>
                            <button id="clear-search-btn" class="action-button secondary flex-shrink-0">Clear Search</button>
                        </div>
                        
                        <div class="flex flex-wrap gap-3 my-4 border-t pt-4">
                            <button onclick="redirectCreatePolicyModule()" class="action-button text-sm"><i class="fas fa-plus mr-2"></i>Create Pension Policy</button>
                            <button onclick="redirectToCreateCustomerModule()" class="action-button text-sm"><i class="fas fa-user-plus mr-2"></i>Create Customer</button>
                            <button onclick="redirectToVerifyCustomerDetailsModle()" class="action-button text-sm"><i class="fas fa-user-check mr-2"></i>Verify Customer Details</button>
                            <button onclick="redirectToManageWorkitem()" class="action-button text-sm"><i class="fas fa-tasks mr-2"></i>Manage Work Items</button>
							<button onclick="redirectToCreateBank()" class="action-button text-sm"><i class="fas fa-university mr-2"></i>Add Bank Details</button>
                             </div>

                        <details class="filter-section border-t pt-4">
                            <summary>
                                <i class="fa-solid fa-filter mr-2"></i> Advanced Filters
                                <i class="fa-solid fa-chevron-down ml-auto"></i>
                            </summary>
                            <div class="filter-criteria">
                                <div>
                                    <label for="filter-status" class="block text-sm font-medium text-gray-600">Status:</label>
                                    <select id="filter-status" class="input-field mt-1">
                                        <option value="">All</option>
                                        <option value="ACTIVE">ACTIVE</option>
                                        <option value="PENDING">PENDING</option>
                                        <option value="IN_PROGRESS">IN PROGRESS</option>
                                        <option value="APPROVED">APPROVED</option>
                                        <option value="REJECTED">REJECTED</option>
                                        <option value="LAPSED">LAPSED</option>
                                        <option value="MATURED">MATURED</option>
                                        <option value="CLOSED">CLOSED</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="filter-payment-frequency" class="block text-sm font-medium text-gray-600">Payment Frequency:</label>
                                    <select id="filter-payment-frequency" class="input-field mt-1">
                                        <option value="">All</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Quarterly">Quarterly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="filter-start-age" class="block text-sm font-medium text-gray-600">Start Age (Min):</label>
                                    <input type="number" id="filter-start-age" class="input-field mt-1">
                                </div>
                                <div>
                                    <label for="filter-benefit-age" class="block text-sm font-medium text-gray-600">Benefit Age (Min):</label>
                                    <input type="number" id="filter-benefit-age" class="input-field mt-1">
                                </div>
                            </div>
                            <div class="flex justify-end gap-3 mt-4">
                                <button id="apply-filters-btn" class="action-button"><i class="fas fa-filter mr-2"></i> Apply Filters</button>
                                <button id="clear-filters-btn" class="action-button secondary"><i class="fas fa-times mr-2"></i> Clear Filters</button>
                            </div>
                        </details>
                    </div>

                    <!-- View Toggle & Policy List Tabs -->
                    <div class="flex justify-between items-center mb-1">
                        <div class="tab-button-group">
                            <button class="tab-button active" data-status-filter="">All</button>
                            <button class="tab-button" data-status-filter="IN_PROGRESS">In Progress</button>
                            <button class="tab-button" data-status-filter="APPROVED">Approved</button>
                            <button class="tab-button" data-status-filter="REJECTED">Rejected</button>
                            <button class="tab-button" data-status-filter="PENDING">Pending</button>
                            <button class="tab-button" data-status-filter="LAPSED">Lapsed</button>
                            <button class="tab-button" data-status-filter="MATURED">Matured</button>
                            <button class="tab-button" data-status-filter="CLOSED">Closed</button>
                        </div>
                        <div class="flex items-center gap-2 flex-shrink-0 ml-4">
                            <button id="grid-view-btn" class="view-toggle-button text-gray-600 p-2 rounded-md active-view" title="Grid View"><i class="fas fa-th-large"></i></button>
                            <button id="list-view-btn" class="view-toggle-button text-gray-600 p-2 rounded-md" title="List View"><i class="fas fa-list"></i></button>
                        </div>
                    </div>

                    <!-- Policy List -->
                    <div id="policy-list-container">
                        <!-- Policy cards or table will be rendered here -->
                    </div>
                    <p id="no-policies-message" class="text-center text-gray-500 mt-8 hidden">No pension policies found matching your criteria.</p>

                    <!-- Actionable Requests Section -->
                    <div class="info-card mt-8">
                        <h3 class="text-xl font-bold text-blue-700 mb-4">Actionable Requests</h3>
                        <div id="pending-requests-container" class="space-y-4">
                            <!-- Pending requests will be rendered here -->
                        </div>
                        <p id="no-pending-requests" class="text-center text-gray-500 mt-4 hidden">No pending policy requests.</p>
                    </div>
                </div>

                <div id="processed-requests-view" class="hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Processed Requests</h2>
                    <div id="processed-requests-container" class="space-y-4">
                        <!-- Processed request cards will be rendered here -->
                    </div>
                     <p id="no-processed-requests" class="text-center text-gray-500 mt-8 hidden">No processed requests found.</p>
                </div>

            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="profile-modal" class="modal-overlay hidden">
        <div class="modal-box w-11/12 max-w-sm text-center p-8 rounded-xl transform">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-semibold text-gray-800">User Info</h3>
                <button onclick="closeModal('profile-modal')" class="modal-close-btn"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="text-gray-600 mb-6 space-y-3 bg-gray-50 p-4 rounded-lg text-left">
                <p><i class="fa-solid fa-id-card w-5 mr-2 text-gray-400"></i><span class="font-medium">User Code:</span> <span id="profile-userCode-display">&nbsp;</span></p>
                <p><i class="fa-solid fa-user-tag w-5 mr-2 text-gray-400"></i><span class="font-medium">Customer No:</span> <span id="profile-customerNo-display">&nbsp;</span></p>
            </div>
        </div>
    </div>

    <div id="policyDetailAdminModal" class="modal-overlay hidden">
        <div class="modal-box w-11/12 max-w-6xl text-left p-6 rounded-lg">
            <button class="modal-close-btn" onclick="closeModal('policyDetailAdminModal')"><i class="fas fa-times"></i></button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6">Manage Pension Policy: <span id="modal-policy-number"></span></h2>
            <div class="modal-content custom-scrollbar">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="policy-detail-section">
                        <h3>Policy Overview</h3>
                        <div class="space-y-3 text-gray-700">
                            <div>
                                <label for="detail-policy-number" class="block text-sm font-medium text-gray-600">Policy Number:</label>
                                <input type="text" id="detail-policy-number" class="input-field mt-1" readonly>
                            </div>
                            <div>
                                <label for="detail-policy-holder" class="block text-sm font-medium text-gray-600">Policy Holder:</label>
                                <input type="text" id="detail-policy-holder" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-customer-number" class="block text-sm font-medium text-gray-600">Customer Number:</label>
                                <input type="text" id="detail-customer-number" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-start-date" class="block text-sm font-medium text-gray-600">Start Date:</label>
                                <input type="date" id="detail-start-date" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-maturity-date" class="block text-sm font-medium text-gray-600">Maturity Date:</label>
                                <input type="date" id="detail-maturity-date" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-policy-status" class="block text-sm font-medium text-gray-600">Policy Status:</label>
                                <select id="detail-policy-status" class="input-field mt-1">
                                    <option value="ACTIVE">ACTIVE</option>
                                    <option value="PENDING">PENDING</option>
                                    <option value="IN_PROGRESS">IN PROGRESS</option>
                                    <option value="APPROVED">APPROVED</option>
                                    <option value="REJECTED">REJECTED</option>
                                    <option value="LAPSED">LAPSED</option>
                                    <option value="MATURED">MATURED</option>
                                    <option value="CLOSED">CLOSED</option>
                                </select>
                            </div>
                            <div class="flex justify-end pt-2 gap-2">
                                <button onclick="updatePolicyDetails()" class="action-button"><i class="fas fa-save mr-2"></i> Update Policy</button>
                            </div>
                        </div>
                    </div>

                    <div class="policy-detail-section">
                        <h3>Contribution Details</h3>
                        <div class="space-y-3 text-gray-700">
                            <div>
                                <label for="detail-premium-amount" class="block text-sm font-medium text-gray-600">Premium Amount:</label>
                                <input type="number" id="detail-premium-amount" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-payment-frequency" class="block text-sm font-medium text-gray-600">Payment Frequency:</label>
                                <select id="detail-payment-frequency" class="input-field mt-1">
                                    <option value="Monthly">Monthly</option>
                                    <option value="Quarterly">Quarterly</option>
                                    <option value="Yearly">Yearly</option>
                                </select>
                            </div>
                            <div>
                                <label for="detail-current-age" class="block text-sm font-medium text-gray-600">Current Age:</label>
                                <input type="number" id="detail-current-age" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-start-age" class="block text-sm font-medium text-gray-600">Start Age:</label>
                                <input type="number" id="detail-start-age" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-benefit-age" class="block text-sm font-medium text-gray-600">Benefit Age:</label>
                                <input type="number" id="detail-benefit-age" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-last-payment-date" class="block text-sm font-medium text-gray-600">Last Payment:</label>
                                <input type="date" id="detail-last-payment-date" class="input-field mt-1">
                            </div>
                            <div>
                                <label for="detail-next-payment-date" class="block text-sm font-medium text-gray-600">Next Payment Due:</label>
                                <input type="date" id="detail-next-payment-date" class="input-field mt-1">
                            </div>
                            <div class="flex justify-end pt-2">
                                <button onclick="updateContributionDetails()" class="action-button"><i class="fas fa-save mr-2"></i> Update Contribution</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="policy-detail-section">
                    <h3>Nominee Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                        <div>
                            <label for="detail-nominee-name" class="block text-sm font-medium text-gray-600">Nominee Name:</label>
                            <input type="text" id="detail-nominee-name" class="input-field mt-1">
                        </div>
                        <div>
                             <label for="detail-nominee-relationship" class="block text-sm font-medium text-gray-600">Relationship:</label>
                            <input type="text" id="detail-nominee-relationship" class="input-field mt-1">
                        </div>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button onclick="updateNomineeDetails()" class="action-button"><i class="fas fa-user-edit mr-2"></i> Update Nominee</button>
                    </div>
                </div>

                <div id="bank-details-section" class="policy-detail-section">
                    <h3>Bank Account Details</h3>
                    <div id="bank-details-content" class="space-y-4">
                        <!-- Bank cards will be rendered here -->
                    </div>
                    <p id="no-bank-accounts-message" class="text-center text-gray-500 mt-4 hidden">No bank accounts found for this customer.</p>
                    <div id="bank-pagination-controls" class="flex justify-between items-center mt-4">
                        <!-- Pagination will be rendered here -->
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                     <div class="policy-detail-section">
                        <h3>Fund Performance</h3>
                        <div class="space-y-2 text-gray-700">
                            <div>
                                <label for="detail-fund-value" class="block text-sm font-medium text-gray-600">Current Fund Value:</label>
                                <input type="number" id="detail-fund-value" class="input-field mt-1">
                            </div>
                            <p class="text-sm text-gray-500">Last updated: <span id="detail-fund-last-updated"></span></p>
                            <button onclick="updateFundDetails()" class="action-button px-4 py-2 mt-2"><i class="fas fa-sync-alt mr-2"></i> Update Fund Value</button>
                        </div>
                    </div>
                    <div class="policy-detail-section">
                        <h3>Key Benefits</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700" id="detail-benefits-list"></ul>
                        <button onclick="openAddBenefitModal()" class="action-button mt-4"><i class="fas fa-plus-circle mr-2"></i> Add/Edit Benefits</button>
                    </div>
                </div>
               
                <div class="policy-detail-section">
                    <h3>Payment History</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead>
                                <tr class="bg-blue-50 text-blue-700 text-left">
                                    <th class="py-2 px-4 border-b">Date</th>
                                    <th class="py-2 px-4 border-b">Amount</th>
                                    <th class="py-2 px-4 border-b">Status</th>
                                    <th class="py-2 px-4 border-b text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="detail-payment-history-table-body">
                            </tbody>
                        </table>
                    </div>
                    <p id="detail-no-payment-history" class="text-center text-gray-500 mt-4 hidden">No payment history available.</p>
                    <button onclick="openAddPaymentModal()" class="action-button mt-4"><i class="fas fa-plus-circle mr-2"></i> Add New Payment</button>
                </div>
            </div>
        </div>
    </div>

    <div id="add-payment-modal" class="modal-overlay hidden">
        <div class="modal-box w-11/12 max-w-md text-left p-6 rounded-lg">
            <button class="modal-close-btn" onclick="closeModal('add-payment-modal')"><i class="fas fa-times"></i></button>
            <h3 class="text-2xl font-bold text-blue-600 mb-4">Add New Payment</h3>
            <div class="space-y-4">
                <div>
                    <label for="new-payment-date" class="block text-sm font-medium text-gray-700">Payment Date:</label>
                    <input type="date" id="new-payment-date" class="input-field mt-1">
                </div>
                <div>
                    <label for="new-payment-amount" class="block text-sm font-medium text-gray-700">Amount:</label>
                    <input type="number" id="new-payment-amount" class="input-field mt-1" placeholder="Enter amount">
                </div>
                <div>
                    <label for="new-payment-status" class="block text-sm font-medium text-gray-700">Status:</label>
                    <select id="new-payment-status" class="input-field mt-1">
                        <option value="Paid">Paid</option>
                        <option value="Pending">Pending</option>
                        <option value="Overdue">Overdue</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 mt-4">
                    <button onclick="addNewPayment()" class="action-button"><i class="fas fa-plus mr-2"></i> Add Payment</button>
                    <button onclick="closeModal('add-payment-modal')" class="action-button secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div id="edit-benefits-modal" class="modal-overlay hidden">
        <div class="modal-box w-11/12 max-w-lg text-left p-6 rounded-lg">
            <button class="modal-close-btn" onclick="closeModal('edit-benefits-modal')"><i class="fas fa-times"></i></button>
            <h3 class="text-2xl font-bold text-blue-600 mb-4">Manage Policy Benefits</h3>
            <div id="current-benefits-list-modal" class="space-y-2 mb-4">
                <!-- Current benefits will be loaded here -->
            </div>
            <div>
                <label for="new-benefit-input" class="block text-sm font-medium text-gray-700">Add New Benefit:</label>
                <input type="text" id="new-benefit-input" class="input-field mt-1" placeholder="e.g., ₹ 50,000 per month annuity option post 60">
            </div>
            <div class="flex justify-end gap-3 mt-4">
                <button onclick="addBenefitToList()" class="action-button"><i class="fas fa-plus mr-2"></i> Add Benefit</button>
                <button onclick="saveBenefits()" class="action-button"><i class="fas fa-save mr-2"></i> Save Changes</button>
                <button onclick="closeModal('edit-benefits-modal')" class="action-button secondary">Cancel</button>
            </div>
        </div>
    </div>

    <div id="notificationModal" class="modal-overlay hidden">
        <div class="modal-box w-11/12 max-w-sm text-center p-6 rounded-lg">
            <h3 id="notification-title" class="text-xl font-bold mb-3"></h3>
            <p id="notification-message" class="text-gray-700"></p>
            <div class="mt-4 flex justify-center gap-3">
                <button id="notification-close-btn" class="action-button">OK</button>
            </div>
        </div>
    </div>

    <div id="deleteConfirmationModal" class="modal-overlay hidden">
        <div class="modal-box p-6 rounded-lg">
            <h3 class="text-xl font-bold text-red-600 mb-3"><i class="fas fa-exclamation-triangle mr-2"></i> Confirm Deletion</h3>
            <p class="text-gray-700 mb-6">Are you sure you want to delete this policy? This action cannot be undone.</p>
            <div class="flex justify-center gap-4">
                <button id="confirm-delete-btn" class="action-button red">OK</button>
                <button id="cancel-delete-btn" class="action-button secondary">Cancel</button>
            </div>
        </div>
    </div>

    <footer class="main-footer">© 2025 Secure Access Limited. All rights reserved ❤️ Company.</footer>
    
    <script>
        const PENSION_SERVICE_BASE_URL = 'http://localhost:9091/pensionServices';

        const config = { 
            loginUrl: 'login', 
            userCode: sessionStorage.getItem('userCode'), 
            customerNo: sessionStorage.getItem('customerNo'),
            userEmail: sessionStorage.getItem('userEmail'), 
        };

        let allPensionPolicies = [
            { id: 1, policyNumber: "PENSION/001/2025", policyHolder: "John Doe", customerNumber: "T0000032025", startDate: "2025-01-01", policyStatus: "ACTIVE", premiumAmount: 500.00, currency: "INR", paymentFrequency: "Monthly", currentAge: 35, startAge: 18, benefitAge: 60, maturityDate: "2050-01-01", fundValue: 150000.00, fundLastUpdated: "2025-08-20", nominee: { name: "Jane Doe", relationship: "Spouse"}, lastPaymentDate: "2025-07-20", nextPaymentDate: "2025-08-20", benefits: [ "₹ 50,00,000 lump sum at age 60", "₹ 50,000 per month annuity option post 60", "100% of fund value or 10 times annual premium, whichever is higher (Death Benefit)", "Flexible payment options (Monthly, Quarterly, Yearly)" ], paymentHistory: [ { id: 101, date: "2025-01-20", amount: 500.00, status: "Paid" }, { id: 102, date: "2025-02-20", amount: 500.00, status: "Paid" }, { id: 103, date: "2025-03-20", amount: 500.00, status: "Paid" }, { id: 104, date: "2025-04-20", amount: 500.00, status: "Paid" }, { id: 105, date: "2025-05-20", amount: 500.00, status: "Paid" }, { id: 106, date: "2025-06-20", amount: 500.00, status: "Paid" }, { id: 107, date: "2025-07-20", amount: 500.00, status: "Paid" }, ] },
            { id: 2, policyNumber: "PENSION/002/2025", policyHolder: "Alice Smith", customerNumber: "CUST12346", startDate: "2025-03-10", policyStatus: "IN_PROGRESS", premiumAmount: 750.00, currency: "INR", paymentFrequency: "Quarterly", currentAge: 40, startAge: 25, benefitAge: 65, maturityDate: "2050-03-10", fundValue: 50000.00, fundLastUpdated: "2025-08-15", nominee: { name: "Bob Smith", relationship: "Son" }, lastPaymentDate: "2025-06-10", nextPaymentDate: "2025-09-10", benefits: [ "₹ 75,00,000 lump sum at age 65", "₹ 70,000 per month annuity option post 65" ], paymentHistory: [ { id: 201, date: "2025-03-10", amount: 750.00, status: "Paid" }, { id: 202, date: "2025-06-10", amount: 750.00, status: "Paid" }, ] },
            { id: 3, policyNumber: "PENSION/003/2025", policyHolder: "Charlie Brown", customerNumber: "CUST12347", startDate: "2024-11-01", policyStatus: "APPROVED", premiumAmount: 300.00, currency: "INR", paymentFrequency: "Yearly", currentAge: 28, startAge: 20, benefitAge: 55, maturityDate: "2050-11-01", fundValue: 100000.00, fundLastUpdated: "2025-08-01", nominee: { name: "Sally Brown", relationship: "Sister"}, lastPaymentDate: "2024-11-01", nextPaymentDate: "2025-11-01", benefits: [ "₹ 30,00,000 lump sum at age 55" ], paymentHistory: [ { id: 301, date: "2024-11-01", amount: 300.00, status: "Paid" }, ] },
            { id: 4, policyNumber: "PENSION/004/2025", policyHolder: "Diana Prince", customerNumber: "CUST12348", startDate: "2023-05-15", policyStatus: "REJECTED", premiumAmount: 600.00, currency: "INR", paymentFrequency: "Monthly", currentAge: 50, startAge: 45, benefitAge: 60, maturityDate: "2038-05-15", fundValue: 0.00, fundLastUpdated: "2023-05-15", nominee: { name: "Steve Trevor", relationship: "Partner" }, lastPaymentDate: "2023-05-15", nextPaymentDate: "2023-06-15", benefits: [], paymentHistory: [ { id: 401, date: "2023-05-15", amount: 600.00, status: "Paid" }, ] },
            { id: 5, policyNumber: "PENSION/005/2025", policyHolder: "Eva Green", customerNumber: "CUST12349", startDate: "2020-01-01", policyStatus: "LAPSED", premiumAmount: 400.00, currency: "INR", paymentFrequency: "Monthly", currentAge: 45, startAge: 30, benefitAge: 60, maturityDate: "2045-01-01", fundValue: 80000.00, fundLastUpdated: "2022-12-31", nominee: { name: "James Bond", relationship: "Friend" }, lastPaymentDate: "2022-11-01", nextPaymentDate: "2022-12-01", benefits: [ "Reduced paid-up sum at maturity" ], paymentHistory: [ { id: 501, date: "2020-01-01", amount: 400.00, status: "Paid" }, { id: 502, date: "2020-02-01", amount: 400.00, status: "Paid" }, { id: 503, date: "2020-03-01", amount: 400.00, status: "Paid" }, { id: 504, date: "2020-04-01", amount: 400.00, status: "Unpaid" }, ] },
            { id: 6, policyNumber: "PENSION/006/2025", policyHolder: "Frank White", customerNumber: "CUST12350", startDate: "2015-06-01", policyStatus: "MATURED", premiumAmount: 1000.00, currency: "INR", paymentFrequency: "Yearly", currentAge: 62, startAge: 40, benefitAge: 60, maturityDate: "2035-06-01", fundValue: 2500000.00, fundLastUpdated: "2035-06-01", nominee: { name: "Grace White", relationship: "Spouse"}, lastPaymentDate: "2034-06-01", nextPaymentDate: null, benefits: [ "₹ 25,00,000 lump sum received", "Option for monthly annuity commenced" ], paymentHistory: [] },
        ];

        let mockUpcomingRequests = [
            { id: 1, policyNumber: "PENSION/002/2025", requestType: "Address Change", requestDate: "2025-08-18", status: "IN_PROGRESS", details: "Customer requested update of residential address." },
            { id: 2, policyNumber: "PENSION/001/2025", requestType: "Payment Frequency Change", requestDate: "2025-08-19", status: "PENDING", details: "Customer wants to change payment frequency from Monthly to Quarterly." },
            { id: 3, policyNumber: "PENSION/003/2025", requestType: "Nominee Update", requestDate: "2025-08-17", status: "APPROVED", details: "Updated nominee from Sally Brown to Tom Brown." }
        ];

        let currentActivePolicy = null;
        let currentFilterStatus = '';
        let currentSearchTerm = '';
        let currentAdvancedFilters = {};
        let policyIdToDelete = null;
        let currentViewMode = 'grid';
        let currentCustomerForBank = null;

		function redirectToManageWorkitem() { window.location.href = "AdminPanel"; }
		function redirectToVerifyCustomerDetailsModle() { window.location.href = "AdminPanel"; }
		function redirectToCreateCustomerModule() { window.location.href = "AdminPanel"; }
		function redirectCreatePolicyModule() { window.location.href = "CreatePensionPolicy"; }
        function redirectToCreateBank() { window.location.href = "CreateBankAccount.html"; }

        const modals = {
            'profile-modal': document.getElementById('profile-modal'),
            'policyDetailAdminModal': document.getElementById('policyDetailAdminModal'),
            'add-payment-modal': document.getElementById('add-payment-modal'),
            'edit-benefits-modal': document.getElementById('edit-benefits-modal'),
            'notificationModal': document.getElementById('notificationModal'),
            'deleteConfirmationModal': document.getElementById('deleteConfirmationModal')
        };

        const notificationTitle = document.getElementById('notification-title');
        const notificationMessage = document.getElementById('notification-message');
        const notificationCloseBtn = document.getElementById('notification-close-btn');

        function showNotification(message, type = 'info', title = 'Message', duration = 3000) {
            if (modals['notificationModal'] && notificationTitle && notificationMessage && notificationCloseBtn) {
                notificationTitle.textContent = title;
                notificationMessage.textContent = message;
                const modalBox = modals['notificationModal'].querySelector('.modal-box');
                notificationTitle.classList.remove('text-red-600', 'text-green-600', 'text-blue-600');
                if (type === 'error') {
                    notificationTitle.classList.add('text-red-600');
                } else if (type === 'success') {
                    notificationTitle.classList.add('text-green-600');
                } else { 
                    notificationTitle.classList.add('text-blue-600');
                }
                openModal('notificationModal');
                const handleClose = () => closeModal('notificationModal');
                notificationCloseBtn.addEventListener('click', handleClose, { once: true });
                if (type !== 'error' && duration > 0) {
                    setTimeout(handleClose, duration);
                }
            } else {
                alert(`${title}: ${message}`);
            }
        }

        function switchView(viewName) {
            const pensionView = document.getElementById('pension-management-view');
            const processedView = document.getElementById('processed-requests-view');
            document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
            if (viewName === 'processed') {
                pensionView.classList.add('hidden');
                processedView.classList.remove('hidden');
                renderProcessedRequests();
                document.querySelector('.sidebar-link[onclick*="switchView(\'processed\')"]').classList.add('active');
            } else {
                pensionView.classList.remove('hidden');
                processedView.classList.add('hidden');
                document.querySelector('.sidebar-link[onclick*="switchView(\'pension\')"]').classList.add('active');
            }
        }
        
        function navigateTo(page) {
            const pageUrls = {
                dashboard: 'dashboard.html',
                policySurrenderAdmin: 'SurrenderPolicyAdmin.html',
                policyClaimAdmin: 'ClaimPolicyAdmin.html',
                bankAccount:'PaymentForCustomer.html',
                payment: 'PaymentForCustomer.html',
                complaints:'ServicePage.html',
                notes: 'AddNotes.html',
                documents: 'DocumentService.html',
                policyHealthCheck: 'PensionManagement.html',
                logout: 'login.html'
            };
            const targetFileName = pageUrls[page];
            if (!targetFileName) {
                showNotification(`Navigation to "${page}" is not configured.`, 'error', 'Navigation Error');
                return;
            }
            if (page === 'logout') {
                sessionStorage.clear();
                window.location.href = config.loginUrl;
                return;
            }
            window.location.href = targetFileName;
        }

        function initializeUser() {
            config.userCode = sessionStorage.getItem('userCode');
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('customerNo')) {
                config.customerNo = urlParams.get('customerNo');
                sessionStorage.setItem('customerNo', config.customerNo);
            } else {
                config.customerNo = sessionStorage.getItem('customerNo');
            }
            document.getElementById('display-user-code').textContent = `User Code: ${config.userCode || 'N/A'}`;
            document.getElementById('display-customer-no').textContent = `Customer No: ${config.customerNo || 'N/A'}`;
        }

        function openModal(modalId) {
            if (modals[modalId]) {
                modals[modalId].classList.remove('hidden');
                modals[modalId].classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            if (modals[modalId]) {
                modals[modalId].classList.add('hidden');
                modals[modalId].classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function renderPolicyCounts() {
            const container = document.getElementById('policy-count-cards');
            container.innerHTML = '';
            const counts = [
                { label: 'All Policies', count: allPensionPolicies.length, icon: 'fa-solid fa-users', color: 'bg-blue-500' },
                { label: 'Active', count: allPensionPolicies.filter(p => p.policyStatus === 'ACTIVE').length, icon: 'fa-solid fa-check-circle', color: 'bg-green-500' },
                { label: 'In Progress', count: allPensionPolicies.filter(p => p.policyStatus === 'IN_PROGRESS').length, icon: 'fa-solid fa-hourglass-half', color: 'bg-yellow-500' },
                { label: 'Approved', count: allPensionPolicies.filter(p => p.policyStatus === 'APPROVED').length, icon: 'fa-solid fa-thumbs-up', color: 'bg-indigo-500' },
                { label: 'Rejected', count: allPensionPolicies.filter(p => p.policyStatus === 'REJECTED').length, icon: 'fa-solid fa-times-circle', color: 'bg-red-500' },
                { label: 'Lapsed', count: allPensionPolicies.filter(p => p.policyStatus === 'LAPSED').length, icon: 'fa-solid fa-ban', color: 'bg-orange-500' },
                { label: 'Matured', count: allPensionPolicies.filter(p => p.policyStatus === 'MATURED').length, icon: 'fa-solid fa-gift', color: 'bg-purple-500' },
                { label: 'Closed', count: allPensionPolicies.filter(p => p.policyStatus === 'CLOSED').length, icon: 'fa-solid fa-folder-closed', color: 'bg-gray-500' },
            ];
            counts.forEach(item => {
                const card = document.createElement('div');
                card.className = `${item.color} text-white p-3 rounded-lg shadow-md flex items-center justify-between transition-transform transform hover:scale-105`;
                card.innerHTML = `<div><div class="text-2xl font-bold">${item.count}</div><div class="text-xs">${item.label}</div></div><i class="${item.icon} text-3xl opacity-75"></i>`;
                container.appendChild(card);
            });
        }

        function applyCurrentFilters() {
             if (currentViewMode === 'grid') {
                renderPolicyListAsGrid(currentFilterStatus, currentSearchTerm, currentAdvancedFilters);
            } else {
                renderPolicyListAsTable(currentFilterStatus, currentSearchTerm, currentAdvancedFilters);
            }
        }
        
        function getFilteredPolicies(statusFilter, searchTerm, advancedFilters) {
             let filteredPolicies = [...allPensionPolicies];
            if (statusFilter) {
                filteredPolicies = filteredPolicies.filter(policy => policy.policyStatus === statusFilter);
            }
            if (searchTerm) {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                filteredPolicies = filteredPolicies.filter(policy =>
                    policy.policyNumber.toLowerCase().includes(lowerCaseSearchTerm) ||
                    policy.policyHolder.toLowerCase().includes(lowerCaseSearchTerm) ||
                    policy.customerNumber.toLowerCase().includes(lowerCaseSearchTerm)
                );
            }
            if (advancedFilters.status) filteredPolicies = filteredPolicies.filter(p => p.policyStatus === advancedFilters.status);
            if (advancedFilters.paymentFrequency) filteredPolicies = filteredPolicies.filter(p => p.paymentFrequency === advancedFilters.paymentFrequency);
            if (advancedFilters.startAge) filteredPolicies = filteredPolicies.filter(p => p.startAge >= parseInt(advancedFilters.startAge));
            if (advancedFilters.benefitAge) filteredPolicies = filteredPolicies.filter(p => p.benefitAge >= parseInt(advancedFilters.benefitAge));
            return filteredPolicies;
        }

        function renderPolicyListAsGrid(statusFilter = '', searchTerm = '', advancedFilters = {}) {
            const container = document.getElementById('policy-list-container');
            const noPoliciesMessage = document.getElementById('no-policies-message');
            container.innerHTML = '';
            const filteredPolicies = getFilteredPolicies(statusFilter, searchTerm, advancedFilters);
            noPoliciesMessage.classList.toggle('hidden', filteredPolicies.length > 0);
            if (filteredPolicies.length === 0) return;
            const gridContainer = document.createElement('div');
            gridContainer.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';
            filteredPolicies.forEach(policy => {
                const card = document.createElement('div');
                card.className = 'policy-card cursor-pointer';
                card.onclick = () => openPolicyDetailModal(policy.id);
                const statusClass = `status-${policy.policyStatus}`;
                card.innerHTML = `
                    <h4 title="${policy.policyHolder}">${policy.policyHolder}</h4>
                    <p><strong>Policy No:</strong> ${policy.policyNumber}</p>
                    <p><strong>Customer No:</strong> ${policy.customerNumber}</p>
                    <p><strong>Status:</strong> <span class="status-badge ${statusClass}">${policy.policyStatus.replace('_', ' ')}</span></p>
                    <p class="text-xs text-gray-500">Starts: ${policy.startDate} | Benefit Age: ${policy.benefitAge}</p>
                    <div class="flex justify-end mt-2 gap-2">
                        <button class="action-button px-3 py-1 text-sm" onclick="event.stopPropagation(); openPolicyDetailModal(${policy.id})"><i class="fas fa-eye mr-1"></i> View</button>
                        <button class="action-button red px-3 py-1 text-sm" onclick="openDeleteConfirmation(${policy.id}, event)"><i class="fas fa-trash-alt mr-1"></i> Delete</button>
                    </div>`;
                gridContainer.appendChild(card);
            });
            container.appendChild(gridContainer);
        }

        function renderPolicyListAsTable(statusFilter = '', searchTerm = '', advancedFilters = {}) {
            const container = document.getElementById('policy-list-container');
            const noPoliciesMessage = document.getElementById('no-policies-message');
            container.innerHTML = '';
            const filteredPolicies = getFilteredPolicies(statusFilter, searchTerm, advancedFilters);
            noPoliciesMessage.classList.toggle('hidden', filteredPolicies.length > 0);
            if (filteredPolicies.length === 0) return;
            const table = document.createElement('table');
            table.className = 'policy-list-table';
            table.innerHTML = `<thead><tr><th>Policy Holder</th><th>Policy No</th><th>Status</th><th>Maturity Date</th><th class="actions-cell">Actions</th></tr></thead><tbody></tbody>`;
            const tbody = table.querySelector('tbody');
            filteredPolicies.forEach(policy => {
                const row = document.createElement('tr');
                const statusClass = `status-${policy.policyStatus}`;
                row.innerHTML = `
                    <td>${policy.policyHolder}</td>
                    <td>${policy.policyNumber}</td>
                    <td><span class="status-badge ${statusClass}">${policy.policyStatus.replace('_', ' ')}</span></td>
                    <td>${policy.maturityDate}</td>
                    <td class="actions-cell"><div class="flex justify-end gap-2">
                        <button class="action-button px-3 py-1 text-sm" onclick="openPolicyDetailModal(${policy.id})"><i class="fas fa-eye mr-1"></i> View</button>
                        <button class="action-button red px-3 py-1 text-sm" onclick="openDeleteConfirmation(${policy.id}, event)"><i class="fas fa-trash-alt mr-1"></i> Delete</button>
                    </div></td>`;
                tbody.appendChild(row);
            });
            container.appendChild(table);
        }

        document.getElementById('apply-search-btn').addEventListener('click', () => {
            currentSearchTerm = document.getElementById('policy-search-input').value.trim();
            document.querySelectorAll('.filter-section input, .filter-section select').forEach(el => el.value = '');
            currentAdvancedFilters = {};
            document.querySelectorAll('.tab-button-group .tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.tab-button-group .tab-button[data-status-filter=""]').classList.add('active');
            currentFilterStatus = '';
            applyCurrentFilters();
        });

        document.getElementById('clear-search-btn').addEventListener('click', () => {
            document.getElementById('policy-search-input').value = '';
            currentSearchTerm = '';
            applyCurrentFilters();
        });

        document.getElementById('apply-filters-btn').addEventListener('click', () => {
            currentAdvancedFilters = {
                status: document.getElementById('filter-status').value,
                paymentFrequency: document.getElementById('filter-payment-frequency').value,
                startAge: document.getElementById('filter-start-age').value,
                benefitAge: document.getElementById('filter-benefit-age').value,
            };
            document.getElementById('policy-search-input').value = '';
            currentSearchTerm = '';
            document.querySelectorAll('.tab-button-group .tab-button').forEach(btn => btn.classList.remove('active'));
            const targetTab = document.querySelector(`.tab-button-group .tab-button[data-status-filter="${currentAdvancedFilters.status}"]`) || document.querySelector('.tab-button-group .tab-button[data-status-filter=""]');
            targetTab.classList.add('active');
            currentFilterStatus = currentAdvancedFilters.status || '';
            applyCurrentFilters();
            document.querySelector('.filter-section').removeAttribute('open');
        });

        document.getElementById('clear-filters-btn').addEventListener('click', () => {
            document.querySelectorAll('.filter-section input, .filter-section select').forEach(el => el.value = '');
            currentAdvancedFilters = {};
            applyCurrentFilters();
            document.querySelector('.filter-section').removeAttribute('open');
        });

        document.querySelectorAll('.tab-button-group .tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button-group .tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentFilterStatus = button.dataset.statusFilter;
                applyCurrentFilters();
            });
        });

        function openPolicyDetailModal(policyId) {
            currentActivePolicy = allPensionPolicies.find(p => p.id === policyId);
            if (!currentActivePolicy) {
                showNotification('Policy not found.', 'error', 'Error');
                return;
            }
            
            // Set customer number and immediately fetch bank details
            currentCustomerForBank = currentActivePolicy.customerNumber;
            fetchBankDetails(currentCustomerForBank, 0, 2);

            populatePolicyDetailModal(currentActivePolicy);
            openModal('policyDetailAdminModal');
        }
        
        function openDeleteConfirmation(policyId, event) {
            event.stopPropagation();
            policyIdToDelete = policyId;
            openModal('deleteConfirmationModal');
        }
        
        function confirmDeletePolicy() {
            if (policyIdToDelete === null) return;
            allPensionPolicies = allPensionPolicies.filter(p => p.id !== policyIdToDelete);
            closeModal('deleteConfirmationModal');
            showNotification('Policy deleted successfully!', 'success');
            renderPolicyCounts();
            applyCurrentFilters();
            policyIdToDelete = null;
        }

        function populatePolicyDetailModal(policy) {
            document.getElementById('modal-policy-number').textContent = policy.policyNumber;
            document.getElementById('detail-policy-number').value = policy.policyNumber;
            document.getElementById('detail-policy-holder').value = policy.policyHolder;
            document.getElementById('detail-customer-number').value = policy.customerNumber;
            document.getElementById('detail-start-date').value = policy.startDate;
            document.getElementById('detail-maturity-date').value = policy.maturityDate;
            document.getElementById('detail-policy-status').value = policy.policyStatus;
            document.getElementById('detail-premium-amount').value = policy.premiumAmount;
            document.getElementById('detail-payment-frequency').value = policy.paymentFrequency;
            document.getElementById('detail-current-age').value = policy.currentAge;
            document.getElementById('detail-start-age').value = policy.startAge;
            document.getElementById('detail-benefit-age').value = policy.benefitAge;
            document.getElementById('detail-last-payment-date').value = policy.lastPaymentDate;
            document.getElementById('detail-next-payment-date').value = policy.nextPaymentDate;
            document.getElementById('detail-fund-value').value = policy.fundValue;
            document.getElementById('detail-fund-last-updated').textContent = policy.fundLastUpdated;
            document.getElementById('detail-nominee-name').value = policy.nominee.name;
            document.getElementById('detail-nominee-relationship').value = policy.nominee.relationship;
            renderDetailBenefitsList();
            renderDetailPaymentHistory();
        }

        function updatePolicyDetails() {
            if (!currentActivePolicy) return;
            currentActivePolicy.policyHolder = document.getElementById('detail-policy-holder').value;
            currentActivePolicy.customerNumber = document.getElementById('detail-customer-number').value;
            currentActivePolicy.startDate = document.getElementById('detail-start-date').value;
            currentActivePolicy.maturityDate = document.getElementById('detail-maturity-date').value;
            currentActivePolicy.policyStatus = document.getElementById('detail-policy-status').value;
            showNotification('Policy details updated successfully!', 'success');
            renderPolicyCounts();
            applyCurrentFilters();
        }
        
        function updateContributionDetails() {
            if (!currentActivePolicy) return;
            currentActivePolicy.premiumAmount = parseFloat(document.getElementById('detail-premium-amount').value);
            currentActivePolicy.paymentFrequency = document.getElementById('detail-payment-frequency').value;
            currentActivePolicy.currentAge = parseInt(document.getElementById('detail-current-age').value);
            currentActivePolicy.startAge = parseInt(document.getElementById('detail-start-age').value);
            currentActivePolicy.benefitAge = parseInt(document.getElementById('detail-benefit-age').value);
            currentActivePolicy.lastPaymentDate = document.getElementById('detail-last-payment-date').value;
            currentActivePolicy.nextPaymentDate = document.getElementById('detail-next-payment-date').value;
            showNotification('Contribution details updated successfully!', 'success');
            applyCurrentFilters();
        }
        
        function updateFundDetails() {
            if (!currentActivePolicy) return;
            currentActivePolicy.fundValue = parseFloat(document.getElementById('detail-fund-value').value);
            currentActivePolicy.fundLastUpdated = new Date().toISOString().slice(0, 10);
            document.getElementById('detail-fund-last-updated').textContent = currentActivePolicy.fundLastUpdated;
            showNotification('Fund value updated successfully!', 'success');
        }

        function updateNomineeDetails() {
            if (!currentActivePolicy) return;
            currentActivePolicy.nominee.name = document.getElementById('detail-nominee-name').value;
            currentActivePolicy.nominee.relationship = document.getElementById('detail-nominee-relationship').value;
            showNotification('Nominee details updated successfully!', 'success');
        }

        function renderDetailBenefitsList() {
            const benefitsList = document.getElementById('detail-benefits-list');
            benefitsList.innerHTML = '';
            if (!currentActivePolicy || !currentActivePolicy.benefits) return;
            currentActivePolicy.benefits.forEach((benefit) => {
                const li = document.createElement('li');
                li.textContent = benefit;
                benefitsList.appendChild(li);
            });
        }

        function openAddBenefitModal() {
            const currentBenefitsListDiv = document.getElementById('current-benefits-list-modal');
            currentBenefitsListDiv.innerHTML = '';
            if (currentActivePolicy && currentActivePolicy.benefits) {
                currentActivePolicy.benefits.forEach((benefit, index) => {
                    const benefitDiv = document.createElement('div');
                    benefitDiv.className = 'flex items-center justify-between p-2 bg-gray-100 rounded-md mb-1';
                    benefitDiv.innerHTML = `
                        <span class="text-gray-800">${benefit}</span>
                        <button class="text-red-500 hover:text-red-700 ml-4" onclick="removeBenefitFromModal(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    currentBenefitsListDiv.appendChild(benefitDiv);
                });
            }
            document.getElementById('new-benefit-input').value = '';
            openModal('edit-benefits-modal');
        }
        
        function addBenefitToList() {
            const newBenefitText = document.getElementById('new-benefit-input').value.trim();
            if (newBenefitText && currentActivePolicy) {
                currentActivePolicy.benefits.push(newBenefitText);
                document.getElementById('new-benefit-input').value = '';
                openAddBenefitModal(); // Re-render the modal content
                showNotification('Benefit added. Click "Save Changes" to finalize.', 'info', '', 1500);
            } else if (!newBenefitText) {
                showNotification('Please enter a benefit description.', 'error', 'Input Required');
            }
        }
        
        function removeBenefitFromModal(index) {
            if (currentActivePolicy && currentActivePolicy.benefits) {
                currentActivePolicy.benefits.splice(index, 1);
                openAddBenefitModal(); // Re-render the modal content
                showNotification('Benefit removed. Click "Save Changes" to finalize.', 'info', '', 1500);
            }
        }
        
        function saveBenefits() {
            renderDetailBenefitsList();
            closeModal('edit-benefits-modal');
            showNotification('Policy benefits updated successfully!', 'success');
        }

        // --- BANK DETAILS ---
        async function fetchBankDetails(customerNo, page = 0, size = 2) {
            const container = document.getElementById('bank-details-content');
            const paginationControls = document.getElementById('bank-pagination-controls');
            container.innerHTML = `<div class="flex items-center justify-center p-4"><i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i><span class="ml-2">Loading bank details...</span></div>`;
            paginationControls.innerHTML = '';
            
            if (!customerNo) {
                container.innerHTML = `<p class="text-center text-red-500 p-4">Customer number is missing.</p>`;
                return;
            }

            try {
				// Using a mock customer number for demonstration as per API response
				const effectiveCustomerNo = 'T0000032025';
                const response = await fetch(`${PENSION_SERVICE_BASE_URL}/bank-details?customerNo=${effectiveCustomerNo}&page=${page}&size=${size}`);
				
				 if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status} - ${errorText}`);
                }
                const result = await response.json();

                if (result.status === "Success" && result.data && result.data.content) {
                    renderBankDetails(result.data.content);
                    renderPaginationControls(result.data);
                } else {
                     throw new Error(result.errorMessage || 'Failed to fetch bank details.');
                }
            } catch (error) {
                console.error("Fetch Bank Details API error:", error);
                container.innerHTML = `<p class="text-center text-red-500 p-4">Failed to load bank details: ${error.message}</p>`;
                document.getElementById('no-bank-accounts-message').classList.add('hidden');
                paginationControls.innerHTML = '';
            }
        }

        function renderBankDetails(accounts) {
            const container = document.getElementById('bank-details-content');
            const noAccountsMessage = document.getElementById('no-bank-accounts-message');
            container.innerHTML = '';

            noAccountsMessage.classList.toggle('hidden', accounts.length > 0);
            if(accounts.length === 0) return;

            accounts.forEach(acc => {
                const card = document.createElement('div');
                card.className = 'bank-card';
                card.innerHTML = `
                    <div class="bank-card-item"><span class="label">Bank Name</span><span class="value">${acc.bankName || 'N/A'}</span></div>
                    <div class="bank-card-item"><span class="label">Account Number</span><span class="value">${acc.accountNumber || 'N/A'}</span></div>
                    <div class="bank-card-item"><span class="label">IFSC Code</span><span class="value">${acc.ifscCode || 'N/A'}</span></div>
                    <div class="bank-card-item"><span class="label">Account Type</span><span class="value">${acc.accountType || 'N/A'}</span></div>
                    <div class="bank-card-item"><span class="label">Default Account</span><span class="value">${acc.isDefaultAccount ? 'Yes' : 'No'}</span></div>
                    <div class="bank-card-item"><span class="label">Status</span><span class="value"><span class="status-badge status-${acc.status}">${acc.status || 'N/A'}</span></span></div>
                `;
                container.appendChild(card);
            });
        }

        function renderPaginationControls(pageData) {
            const container = document.getElementById('bank-pagination-controls');
            container.innerHTML = '';
            if (pageData.totalPages <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.innerHTML = `<i class="fas fa-arrow-left mr-2"></i> Previous`;
            prevButton.className = 'action-button secondary text-sm px-3 py-1';
            prevButton.disabled = pageData.first;
            prevButton.onclick = () => fetchBankDetails(currentCustomerForBank, pageData.number - 1, 2);
            
            const pageInfo = document.createElement('span');
            pageInfo.className = 'text-sm font-medium text-gray-700';
            pageInfo.textContent = `Page ${pageData.number + 1} of ${pageData.totalPages}`;

            const nextButton = document.createElement('button');
            nextButton.innerHTML = `Next <i class="fas fa-arrow-right ml-2"></i>`;
            nextButton.className = 'action-button secondary text-sm px-3 py-1';
            nextButton.disabled = pageData.last;
            nextButton.onclick = () => fetchBankDetails(currentCustomerForBank, pageData.number + 1, 2);

            container.appendChild(prevButton);
            container.appendChild(pageInfo);
            container.appendChild(nextButton);
        }

        // --- Other Functions ---
        function renderDetailPaymentHistory() {
            const paymentHistoryTableBody = document.getElementById('detail-payment-history-table-body');
            const noPaymentHistoryMessage = document.getElementById('detail-no-payment-history');
            paymentHistoryTableBody.innerHTML = '';
            if (!currentActivePolicy || !currentActivePolicy.paymentHistory || currentActivePolicy.paymentHistory.length === 0) {
                noPaymentHistoryMessage.classList.remove('hidden'); return;
            }
            noPaymentHistoryMessage.classList.add('hidden');
            [...currentActivePolicy.paymentHistory].sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(p => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `<td class="py-2 px-4 border-b">${p.date}</td><td class="py-2 px-4 border-b">${currentActivePolicy.currency} ${p.amount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td><td class="py-2 px-4 border-b"><span class="px-2 py-1 rounded-full text-xs font-semibold ${p.status === 'Paid' ? 'bg-green-100 text-green-700' : p.status === 'Pending' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}">${p.status}</span></td><td class="py-2 px-4 border-b text-right space-x-2">${p.status !== 'Paid' ? `<button class="action-button px-3 py-1 text-sm bg-green-500 hover:bg-green-600" onclick="updatePaymentStatus(${p.id}, 'Paid')"><i class="fas fa-check"></i> Paid</button>` : ''}${p.status !== 'Pending' ? `<button class="action-button px-3 py-1 text-sm bg-yellow-500 hover:bg-yellow-600" onclick="updatePaymentStatus(${p.id}, 'Pending')"><i class="fas fa-hourglass-half"></i> Pending</button>` : ''}<button class="action-button px-3 py-1 text-sm bg-red-500 hover:bg-red-600" onclick="deletePayment(${p.id})"><i class="fas fa-trash"></i> Delete</button></td>`;
                paymentHistoryTableBody.appendChild(row);
            });
        }

        function openAddPaymentModal() {
            document.getElementById('new-payment-date').value = new Date().toISOString().slice(0, 10);
            document.getElementById('new-payment-amount').value = '';
            document.getElementById('new-payment-status').value = 'Paid';
            openModal('add-payment-modal');
        }

        function addNewPayment() {
            const date = document.getElementById('new-payment-date').value;
            const amount = parseFloat(document.getElementById('new-payment-amount').value);
            const status = document.getElementById('new-payment-status').value;
            if (!date || isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid date and amount.', 'error', 'Invalid Input'); return;
            }
            if (!currentActivePolicy) return;
            const newPaymentId = currentActivePolicy.paymentHistory.length > 0 ? Math.max(...currentActivePolicy.paymentHistory.map(p => p.id)) + 1 : 1;
            currentActivePolicy.paymentHistory.push({ id: newPaymentId, date, amount, status });
            renderDetailPaymentHistory();
            closeModal('add-payment-modal');
            showNotification('Payment added successfully!', 'success');
        }

        function updatePaymentStatus(paymentId, newStatus) {
            if (!currentActivePolicy) return;
            const payment = currentActivePolicy.paymentHistory.find(p => p.id === paymentId);
            if (payment) {
                payment.status = newStatus;
                renderDetailPaymentHistory();
                showNotification(`Payment ${paymentId} status updated to ${newStatus}.`, 'success');
            }
        }

        function deletePayment(paymentId) {
            if (!currentActivePolicy) return;
            currentActivePolicy.paymentHistory = currentActivePolicy.paymentHistory.filter(p => p.id !== paymentId);
            renderDetailPaymentHistory();
            showNotification(`Payment ${paymentId} deleted.`, 'success');
        }

        function renderPendingRequests() {
            const container = document.getElementById('pending-requests-container');
            const noRequestsMessage = document.getElementById('no-pending-requests');
            container.innerHTML = '';
            const pendingRequests = mockUpcomingRequests.filter(req => req.status === 'PENDING' || req.status === 'IN_PROGRESS');
            noRequestsMessage.classList.toggle('hidden', pendingRequests.length > 0);
            if (pendingRequests.length === 0) return;
            pendingRequests.forEach(request => {
                const card = document.createElement('div');
                card.className = 'request-card';
                card.innerHTML = `<h4>${request.requestType} - Policy: ${request.policyNumber}</h4><p><strong>Date:</strong> ${request.requestDate}</p><p><strong>Details:</strong> ${request.details}</p><p><strong>Status:</strong> <span class="px-2 py-1 rounded-full text-xs font-semibold ${request.status === 'PENDING' ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700'}">${request.status.replace('_', ' ')}</span></p><div class="actions"><button class="action-button bg-green-500 hover:bg-green-600" onclick="handleRequestAction(${request.id}, 'APPROVED')"><i class="fas fa-check-circle mr-2"></i> Approve</button><button class="action-button bg-red-500 hover:bg-red-600" onclick="handleRequestAction(${request.id}, 'REJECTED')"><i class="fas fa-times-circle mr-2"></i> Reject</button></div>`;
                container.appendChild(card);
            });
        }
        
        function renderProcessedRequests() {
            const container = document.getElementById('processed-requests-container');
            const noRequestsMessage = document.getElementById('no-processed-requests');
            container.innerHTML = '';
            const processedRequests = mockUpcomingRequests.filter(req => req.status === 'APPROVED' || req.status === 'REJECTED');
            noRequestsMessage.classList.toggle('hidden', processedRequests.length > 0);
            if (processedRequests.length === 0) return;
            processedRequests.forEach(request => {
                const card = document.createElement('div');
                card.className = 'request-card';
                card.innerHTML = `<h4>${request.requestType} - Policy: ${request.policyNumber}</h4><p><strong>Date:</strong> ${request.requestDate}</p><p><strong>Details:</strong> ${request.details}</p><p><strong>Status:</strong> <span class="px-2 py-1 rounded-full text-xs font-semibold ${request.status === 'APPROVED' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">${request.status.replace('_', ' ')}</span></p>`;
                container.appendChild(card);
            });
        }

        function handleRequestAction(requestId, actionStatus) {
            const request = mockUpcomingRequests.find(req => req.id === requestId);
            if (request) {
                request.status = actionStatus;
                showNotification(`Request ${requestId} has been ${actionStatus.toLowerCase()}.`, 'success');
                renderPendingRequests();
                applyCurrentFilters();
            }
        }

        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        sidebarToggle.addEventListener('click', () => sidebar.classList.toggle('active'));
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeUser();
            renderPolicyCounts();
            applyCurrentFilters();
            renderPendingRequests();

            document.getElementById('btn-profile')?.addEventListener('click', () => {
                document.getElementById('profile-userCode-display').textContent = config.userCode;
                document.getElementById('profile-customerNo-display').textContent = config.customerNo || 'N/A';
                openModal('profile-modal');
            });
            document.getElementById('confirm-delete-btn').addEventListener('click', confirmDeletePolicy);
            document.getElementById('cancel-delete-btn').addEventListener('click', () => closeModal('deleteConfirmationModal'));

            // View Toggle Logic
            const gridViewBtn = document.getElementById('grid-view-btn');
            const listViewBtn = document.getElementById('list-view-btn');
            gridViewBtn.addEventListener('click', () => {
                currentViewMode = 'grid';
                gridViewBtn.classList.add('active-view');
                listViewBtn.classList.remove('active-view');
                applyCurrentFilters();
            });
            listViewBtn.addEventListener('click', () => {
                currentViewMode = 'list';
                listViewBtn.classList.add('active-view');
                gridViewBtn.classList.remove('active-view');
                applyCurrentFilters();
            });
        });
    </script>   
</body>
</html>